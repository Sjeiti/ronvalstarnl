{"id":"1001","date":"2012-06-28T16:40:08","modified":"2014-05-05T21:36:35","slug":"test-rainbow","type":"post","excerpt":"<p>Just a test&#8230;</p>","categories":["uncategorized"],"tags":[],"inCv":false,"inPortfolio":false,"dateFrom":"","dateTo":"","title":"Test Rainbow line numbering","content":"<p>Just a test&#8230;</p>\n<p><!--more--></p>\n<pre><code data-language=\"php\" data-line=\"123\">function mediaSendToEditor($html, $attachment_id, $attachment) {\n\t// check for the GET vars added in boxView\n\tparse_str($_POST['_wp_http_referer'], $aPostVars);\n\tif (isset($aPostVars['target'])&amp;&amp;$aPostVars['target']=='foobarbaz') {\n\t\t// add extra data to the $attachement array prior to returning the json_encoded string\n\t\t$attachment['id'] = $attachment_id;\n\t\t$attachment['edit'] = get_edit_post_link($attachment_id);\n\t\t$attachment['input'] = $aPostVars['input'];\n\t\t$attachment['preview'] = $aPostVars['preview'];\n\t\tif ($aPostVars['type']=='image') {\n\t\t\tforeach (array('thumb','medium','large') as $size) {\n\t\t\t\t$aImg = wp_get_attachment_image_src( $attachment_id, $size);\n\t\t\t\tif ($aImg) $attachment['img_'.$size] = $aImg[0];\n\t\t\t}\n\t\t}\n\t\t$html = json_encode($attachment);\n\t}\n\treturn $html;\n}</code></pre>\n<pre><code data-language=\"javascript\">(function($){\n\tvar fnOldSendToEditor;\n\t$(function(){\n\t\t// store original send_to_editor function\n\t\tfnOldSendToEditor = window.send_to_editor;\n\t\t// add a different send_to_editor function to each thickbox anchor\n\t\tvar $Box = $('#foobarbaz-box');\n\t\tif ($Box.length) {\n\t\t\t$Box.find('a.thickbox').each(function(i,el){\n\t\t\t\tvar $A = $(el).click(function(){\n\t\t\t\t\twindow.send_to_editor = getFnSendToEditor($A.data('type'));\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t// hack tb_remove to reset window.send_to_editor\n\t\tvar fnTmp = window.tb_remove;\n\t\twindow.tb_remove = function(){\n\t\t\tif (fnOldSendToEditor) window.send_to_editor = fnOldSendToEditor;\n\t\t\tfnTmp();\n\t\t};\n\t});\n\tfunction getFnSendToEditor(type){\n\t\treturn function(fileHTML){\n\t\t\tvar oData = JSON.parse(fileHTML);\n\t\t\t//console.log(oData);\n\t\t\t$('#'+oData.input).val(oData.url);\n\t\t\t$('#'+oData.preview).text(type+': '+oData.url.split('/').pop());\n\t\t\ttb_remove();\n\t\t}\n\t}\n})(jQuery);</code></pre>"}