{"id":"2475","description":"How I use Google spreadsheets for my freelance administration: here are two example spreadsheets to duplicate and some details on the used Javascript.","date":"2014-05-10T11:10:39","modified":"2016-12-11T15:26:12","slug":"using-google-spreadsheets-for-invoicing","type":"post","categories":["admin","code","Javascript","work"],"tags":["Google","Javascript","freelance"],"metaDescription":"How I use Google spreadsheets for my freelance administration: here are two example spreadsheets to duplicate and some details on the used Javascript.","metaTitle":"Using Google spreadsheets for your freelance quotations and invoicing","metaKeyword":"spreadsheet","inCv":false,"inPortfolio":false,"dateFrom":"","dateTo":"","title":"Using Google spreadsheets for your freelance invoicing","content":"<p>Being your own boss is great! You get to pick your own clients, your own hours, your own workplace. Not so great is all the administrative work: making quotations, doing taxes, making invoices (although the latter does make me happy). Luckily I have a spreadsheet and Javascript to do some of the boring stuff for me.</p>\n<p><!--more--></p>\n<p class=\"notice\">The methods described here no longer work because Google silently <a href=\"https://code.google.com/p/google-apps-script-issues/issues/detail?id=5174\">disabled a spreadsheets feature</a>.</p>\n<p>Over the years I&#8217;ve tried to automate and streamline my administrative workflow.<br />\nAs co-founder of a small company I was responsible for the financial administration (this was in 2000-ish). I tested a lot of software and used some. We weren&#8217;t comfortable with the online solutions (yet) and the software that was left was not really up to our standards. So in the end we decided to roll our own running on PHP in LAN.<br />\nWhen I left the company in 2007 I tried to use it briefly for my freelance work but I didn&#8217;t feel like fixing all the PHP migration issues (from 4 to 5). After another round of trying to find good accounting software I figured I might as well use Google Docs. The setup I have now is pretty smooth&#8230; well, smooth enough to share.</p>\n<h2>Just two spreadsheets</h2>\n<p>I have two basic documents: <a href=\"https://docs.google.com/spreadsheet/ccc?key=0AgLsBMvUgAW8dGhJSVZsWVFoSnFYYk9ScVJUeFAyb3c&amp;usp=sharing\" target=\"_blank\">one template</a> which I duplicate for each new project, and a <a href=\"https://docs.google.com/spreadsheets/d/1GJB_m7TV3O8Iha099Gb_bahF0eWZl_COfHqifJEV3EM/edit?usp=sharing\" target=\"_blank\">spreadsheet containing generic data</a>.</p>\n<p>The template spreadsheet helps me doing three things:</p>\n<ul>\n<li>estimate the time (=money) for a project</li>\n<li>create a quotation for the client</li>\n<li>create an invoice (and reminders)</li>\n</ul>\n<p>\nThe template is coupled to a second &#8216;static&#8217; spreadsheet in which I keep track of:</p>\n<ul>\n<li>my own data (address, bank account details, etc..)</li>\n<li>all the client data (client id, address, payment term, etc&#8230;)</li>\n<li>basic tasks (bilingual since I sometimes work for international clients)</li>\n<li>basic copy (header, footer, reminder, etc&#8230;)</li>\n</ul>\n<p>\nMy workflow is now as follows: a client asks me for a project and I&#8230;</p>\n<ul>\n<li>duplicate the template spreadsheet, rename it, fill out the clients id, a one line project summary, and a date</li>\n<li>in the next tab/sheet I choose the project tasks from a drop-down and estimate the hours for each task</li>\n<li>then head over to the quotation sheet, write a generic project scope paragraph and download it as PDF</li>\n</ul>\n<p>\nWhen the project is finished I just fill out the invoice date and download the invoice as PDF</p>\n<p>You can check them out here: <a href=\"https://docs.google.com/spreadsheet/ccc?key=0AgLsBMvUgAW8dGhJSVZsWVFoSnFYYk9ScVJUeFAyb3c&amp;usp=sharing\" target=\"_blank\">template</a>, <a href=\"https://docs.google.com/spreadsheets/d/1GJB_m7TV3O8Iha099Gb_bahF0eWZl_COfHqifJEV3EM/edit?usp=sharing\" target=\"_blank\">data</a>. Just duplicate them to fiddle around.<br />\nWhen you duplicate them, make sure you set the &#8216;data sheet key&#8217; in the first row of the template to the one of the data sheet you just duplicated (you can find the key in the url, it&#8217;s the long hash)<br />\n<small>I changed personal values like bank account and hourly rate.</small></p>\n<p>For tldr sake I will not explain all the details, just these three: the calculation, the scripts, and the quotation. Just comment if you have any questions after that.</p>\n<h2>Calculation</h2>\n<p>Here I estimated the hours for a project. It&#8217;s divided into smaller tasks which will show up in the quotation and invoice.<br />\nThe subject can be anything but if you pick it from the dropdown the quotation will have the body text for that task already filled out (more about that later).</p>\n<p><img class=\"alignnone\" src=\"/wordpress/wp-content/uploads/drive_calculation.png\" alt=\"The calculation sheet from the template spreadsheet\" /></p>\n<p>The estimated hours are multiplied by a deviation percentage and a discount percentage.<br />\nThis is always a bit of fiddling. My hourly rate goes down the more hours I estimate (I normally hide rows 13 to 18). Sometimes I work for a fixed project price, and sometimes for an hourly rate.<br />\nThen there&#8217;s the type of client: big agencies are charged more than a sole entrepreneur. And the type of project: if it&#8217;s something really cool, a good cause or just work.<br />\nBut even if I lower my price I always explicitly point that out in the quotation and invoice.</p>\n<h2>Quotation</h2>\n<p>Especially making quotations used to take up a lot of time for me. Writing is not really my thing. And even though a the work I do is diverse, the quotations I make all have very similar setup. But I do not want to send my clients a generic copy-pasted document, I want to make them feel I wrote it specially for them.</p>\n<p>Being a front-end developer I know a thing or two about variables and templating. So that&#8217;s what I used here: the static spreadsheet with the generic data has a sheet called tasks. Each task has a name and a description. The name is what you see in the calculation sheet&#8217;s dropdowns. The description is what will show up on the quotation sheet. The descriptions can have variables, indicated like %so%.<br />\nThe variables can be replaced by values from any sheet where the first column is the key and the second the value (which is why part of the calculation sheet is in the first two columns).</p>\n<p>For instance in the tasks sheet of the data spreadsheet the first entry is &#8216;interaction design&#8217; with the value &#8216;<span data-sheets-value=\"[null,2,&quot;We make some drawings for %project name%.&quot;]\" data-sheets-userformat=\"[null,null,9089,[null,0],null,null,null,null,null,null,2,1,0,null,null,null,10]\">We make some drawings for %project name%.</span>&#8216;.<br />\nIn the template spreadsheet the value is used in the quotation sheet and the variable %project name% is replaced by the corresponding value from the &#8216;data&#8217; sheet. So it now says: &#8216;We make some drawings for ransackthis.&#8217;</p>\n<p>If no key/value pair is present the script responds by returning &#8216;key not found in sheet&#8217;. So if you check the calculation sheet you&#8217;ll notice that the task &#8216;testing&#8217; has a red corner indicating that the key does not exist in the task list. In the quotation sheet you&#8217;ll see &#8221;Testing&#8217; not found in &#8216;tasks&#8221; on row 25. So here we&#8217;ll have to write something ourselves.</p>\n<p>The precise workings of all this is done with the <a title=\"Spreadsheet Service\" href=\"https://developers.google.com/apps-script/reference/spreadsheet/\" target=\"_blank\">Google spreadsheet API</a> and some good old fashioned Javascript.</p>\n<h2>Scripts</h2>\n<p>The template spreadsheet has some custom methods. If you use the top menu and open &#8216;Tools / Script editor&#8217; you&#8217;ll see them.</p>\n<p>The most important methods are &#8216;importSpreadsheet&#8217; and &#8216;getText&#8217;.<br />\nThe sheets from the data spreadsheet are loaded into the template spreadsheet. These imported sheets are hidden, you can unhide them from the main menu &#8216;View / Hidden sheets&#8217;. I used a custom import method here because I needed more dynamics: multiple languages and swapping the client data from a row to a column.<br />\nThe &#8216;getText&#8217; method does the actual variable replacement. It looks for a key in a sheet, then processes the variables in the value by searching the sheets from the third argument.<br />\nJust check the commented code below.</p>\n<pre><code data-language=\"Javascript\">/**\n * Imports a spreadsheet into another spreadsheet as a key-value range.\n * @param {String} sheet The spreadsheet id.\n * @param {String} [tab] The sheet name.\n * @param {String} [keys] The row or column containing the keys.\n * @param {String} [values1] The row or column containing the values.\n * @param {String} [values2] Fallback row or column to use if value is empty.\n * @returns {Array}\n */\nfunction importSpreadsheet(sheet,tab,keys,values1,values2){\n  if (!isset(keys)) keys = 'A1:A';\n  var oSpreadsheet = isset(sheet)?SpreadsheetApp.openById(sheet):SpreadsheetApp.getActiveSpreadsheet()\n\t,oSheet = oSpreadsheet.getSheetByName(isset(tab)?tab:oSpreadsheet.getSheets()[0].getName())\n    ,aKeys = oSheet.getRange(keys).getValues()\n    ,bHorizontal = aKeys.length===1&amp;&amp;aKeys[0].length&gt;1\n    ,bSecondaryValues\n    ,aValues1\n    ,aValues2\n\t,fnSwap = function(v){return [v];}\n  ;\n\n  //var aAlphabet = Array.apply(0,Array(26)).map(function(x,y){return String.fromCharCode(y+65);});\n\n  if (!isset(values1)) values1 = bHorizontal?'A2:2':'B1:B';\n\n  bSecondaryValues = isset(values2);\n  //return JSON.stringify(bSecondaryValues) ;\n\n  aValues1 = oSheet.getRange(values1).getValues();\n  if (bSecondaryValues) aValues2 = oSheet.getRange(values2).getValues();\n\n  if (bHorizontal) {\n    aKeys = aKeys[0].map(fnSwap);\n    aValues1 = aValues1[0].map(fnSwap);\n    if (bSecondaryValues) aValues2 = aValues2[0].map(fnSwap);\n  }\n  //return JSON.stringify(aValues1);\n\n  return aKeys.map(function(key,index){\n    return [key,bSecondaryValues?aValues1[index][0]||aValues2[index][0]:aValues1[index][0]];\n  });\n}\n\n/**\n * Maps a sheet to an object with key-value pairs.\n * @param {String} sheet\n * @returns {Object}\n */\nfunction getDictionary(sheet) { // todo: cache\n  var oSpreadsheet = SpreadsheetApp.getActiveSpreadsheet();\n  var oSheet = oSpreadsheet.getSheetByName(sheet);\n  while(oSheet.getRange('A1').getValues().pop().pop().substr(0,1)===\"#\") {\n    Utilities.sleep(500);\n  }\n  var aRange = oSheet.getDataRange().getValues()\n  ,oDictionary = {};\n  aRange.forEach(function(keyValue){\n    var oValue = keyValue[1]\n    ,bDate = oValue instanceof Date;\n    oDictionary[keyValue[0]] = bDate?dateToDMY(oValue):oValue;\n  });\n  return oDictionary;\n}\n\n/**\n * Get text by key from a sheet.\n * Optionally map %keywords% with values from other sheets.\n * @param {String} sheet The sheet the keyword is in\n * @param {String} key The keyword to find\n * @param {String} [map] A comma separated string with sheet names\n * @returns {*}\n */\nfunction getText(sheet,key,map) {\n  var oDictionary = getDictionary(sheet)\n    ,sText = oDictionary.hasOwnProperty(key)?oDictionary[key]:'''+key+'' not found in ''+sheet+'''\n  ;\n  if (isset(map)) {\n    sText = parseText(sText,map);\n  }\n  return sText;\n}\n\n/**\n * Searches text for %keywords% and replaces them with the corresponding values from other sheets\n * @param {String} text\n * @param {String} A comma separated string with sheet names\n * @returns {String}\n */\nfunction parseText(text,map){\n  var aCodes = text.match(/%([^%]+)%/g);\n  if (aCodes) {\n    var oDictionary = {};\n    map.split(',').forEach(function(mapSheet){\n      extend(oDictionary,getDictionary(mapSheet));\n    });\n    // search and replace codes in text\n    for (var i=0,l=aCodes.length;i&lt;l;i++) {\n      var sCode = aCodes[i]\n      ,sKey = sCode.match(/%([^%]+)%/).pop();\n      if (oDictionary.hasOwnProperty(sKey)) {\n        text = text.replace(sCode,oDictionary[sKey]);\n      }\n    }\n  }\n  return text;\n}\n\n/**\n * Converts a date to d-m-y\n * @param date\n * @returns {string}\n */\nfunction dateToDMY(date) {\n    var d = date.getDate();\n    var m = date.getMonth() + 1;\n    var y = date.getFullYear();\n\treturn [d&lt;=9?'0'+d:d,m&lt;=9?'0'+m:m,y].join('-');\n}\n\n/**\n* Test if a parameter value is properly set (unset parameters from sheets are not undefined).\n* @method\n* @param value {Object} The parameter to test.\n* @returns {Boolean} True if set.\n*/\nfunction isset(value){\n  return value!==\"\"&amp;&amp;value!==null&amp;&amp;value!==undefined;\n}\n\n/**\n* Extend an object\n* @method\n* @param obj {Object} Subject.\n* @param fns {Object} Property object.\n* @returns {Object} Subject.\n*/\nfunction extend(obj,fns){\n  for (var s in fns) if (obj[s]===undefined) obj[s] = fns[s];\n  return obj;\n}\n\n/**\n * Replace a string multiple times\n * @param {String} text\n * @param {..String} [needle] The string to search for\n * @param {..String} [replacement] The replacement\n * @returns {String}\n */\nfunction rereplace(text) {\n  for (var i=1,l=arguments.length;i&lt;l;i+=2){\n    text = text.replace(arguments[i],arguments[i+1]);\n  }\n  return text;\n}</code></pre>\n<h2>Downsides</h2>\n<p>There are some small downsides of course.<br />\nThe main one is that this is Google spreadsheets. So any graphic design is not easy to implement, you&#8217;re stuck with the default fonts and exporting to PDF sometimes sucks because spreadsheets weren&#8217;t made with an A4 (or letter) paper size in mind.<br />\nSometimes the spreadsheet does a to good a job of caching values, especially the scripted ones. In which case you&#8217;ll have to open the script (Tools / Script editor) and hit the save icon so the spreadsheet values are recalculated.</p>\n<p>But apart from that: it&#8217;s relatively easy to use and you have full control.</p>\n<p>&nbsp;</p>"}